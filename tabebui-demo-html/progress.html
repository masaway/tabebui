<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€²æ—è©³ç´° - ãŸã¹ã¶ã„</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">ğŸ¥© ãŸã¹ã¶ã„</a>
            <div class="user-info">
                <div class="level-badge" id="userLevel">Lv.1</div>
                <span id="userName">è‚‰å¥½ããƒ¦ãƒ¼ã‚¶ãƒ¼</span>
            </div>
        </div>
    </header>

    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav class="nav">
        <a href="index.html" class="nav-link">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
        <a href="parts.html" class="nav-link">éƒ¨ä½ã‚’é¸ã¶</a>
        <a href="progress.html" class="nav-link active">é€²æ—è©³ç´°</a>
        <a href="history.html" class="nav-link">å±¥æ­´</a>
    </nav>

    <div class="container">
        <!-- å…¨ä½“åˆ¶è¦‡ç‡ -->
        <div class="card">
            <h2>ğŸ† å…¨ä½“åˆ¶è¦‡çŠ¶æ³</h2>
            <div style="display: flex; align-items: center; gap: 30px; flex-wrap: wrap;">
                <div class="circular-progress" id="overallProgress" style="width: 150px; height: 150px;">
                    <svg>
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#667eea"/>
                                <stop offset="100%" style="stop-color:#764ba2"/>
                            </linearGradient>
                        </defs>
                        <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                        <circle class="circle-progress" cx="75" cy="75" r="65"></circle>
                    </svg>
                    <div class="progress-text" id="overallPercentage" style="font-size: 1.8em;">0%</div>
                </div>
                <div style="flex: 1;">
                    <div id="overallStats">
                        <!-- å‹•çš„ã«ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ¬ãƒ™ãƒ«ãƒ»çµŒé¨“å€¤ -->
        <div class="card">
            <h2>â­ ãƒ¬ãƒ™ãƒ«ãƒ»çµŒé¨“å€¤</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="currentLevel">1</div>
                    <div class="stat-label">ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="currentExp">0</div>
                    <div class="stat-label">ç¾åœ¨ã®çµŒé¨“å€¤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="expToNext">100</div>
                    <div class="stat-label">æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¾ã§</div>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <div class="progress-label">
                    <span>ãƒ¬ãƒ™ãƒ«é€²æ—</span>
                    <span id="levelProgressText">0/100</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="levelProgressBar" style="background: linear-gradient(90deg, #ff9a56, #ff7a00); width: 0%;"></div>
                </div>
            </div>
        </div>

        <!-- å‹•ç‰©åˆ¥è©³ç´°é€²æ— -->
        <div class="card">
            <h2>ğŸ„ğŸ·ğŸ” å‹•ç‰©åˆ¥åˆ¶è¦‡è©³ç´°</h2>
            <div id="animalDetailsContainer">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
        </div>

        <!-- çµ±è¨ˆæƒ…å ± -->
        <div class="card">
            <h2>ğŸ“Š çµ±è¨ˆæƒ…å ±</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
                <div class="stat-card">
                    <div class="stat-value" id="totalRecords">0</div>
                    <div class="stat-label">ç·è¨˜éŒ²æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="thisMonthRecords">0</div>
                    <div class="stat-label">ä»Šæœˆã®è¨˜éŒ²</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="streakDays">0</div>
                    <div class="stat-label">é€£ç¶šè¨˜éŒ²æ—¥æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="averageRating">0.0</div>
                    <div class="stat-label">å¹³å‡æº€è¶³åº¦</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="uniqueRestaurants">0</div>
                    <div class="stat-label">è¨ªå•åº—èˆ—æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="firstRecordDate">-</div>
                    <div class="stat-label">åˆå›è¨˜éŒ²æ—¥</div>
                </div>
            </div>
        </div>

        <!-- ãƒãƒƒã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="card">
            <h2>ğŸ… ãƒãƒƒã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</h2>
            <div id="badgesContainer">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
        </div>

        <!-- æœˆåˆ¥è¨˜éŒ²ã‚°ãƒ©ãƒ• -->
        <div class="card">
            <h2>ğŸ“ˆ æœˆåˆ¥è¨˜éŒ²æ¨ç§»</h2>
            <div id="monthlyChart" style="margin-top: 20px;">
                <!-- ç°¡æ˜“ã‚°ãƒ©ãƒ•è¡¨ç¤º -->
            </div>
        </div>

        <!-- å¸Œå°‘åº¦åˆ¥åˆ¶è¦‡çŠ¶æ³ -->
        <div class="card">
            <h2>â­ å¸Œå°‘åº¦åˆ¥åˆ¶è¦‡çŠ¶æ³</h2>
            <div id="rarityProgress">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç† -->
        <div class="card">
            <h2>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                <button class="btn btn-outline" onclick="exportUserData()">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                <button class="btn btn-outline" onclick="document.getElementById('importFile').click()">ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                <button class="btn" onclick="loadSampleData()" style="background: #f39c12; color: white;">ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿è¿½åŠ </button>
                <button class="btn" onclick="resetAllData()" style="background: #e74c3c; color: white;">å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImportFile(this.files[0])">
        </div>
    </div>

    <script src="js/parts.js"></script>
    <script src="js/records.js"></script>
    <script src="js/main.js"></script>
    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeProgressPage();
        });

        // é€²æ—ãƒšãƒ¼ã‚¸åˆæœŸåŒ–
        function initializeProgressPage() {
            const userLevel = getUserLevel();
            document.getElementById('userLevel').textContent = `Lv.${userLevel}`;
            
            updateOverallProgress();
            updateLevelProgress();
            updateAnimalDetails();
            updateStatistics();
            updateBadges();
            updateMonthlyChart();
            updateRarityProgress();
        }

        // å…¨ä½“é€²æ—æ›´æ–°
        function updateOverallProgress() {
            const stats = getOverallStats();
            const percentage = stats.completionRate;
            
            // å††å½¢é€²æ—æ›´æ–°
            const circle = document.querySelector('.circle-progress');
            const text = document.getElementById('overallPercentage');
            
            if (circle && text) {
                const circumference = 2 * Math.PI * 65; // r=65
                const offset = circumference - (percentage / 100) * circumference;
                circle.style.strokeDasharray = circumference;
                circle.style.strokeDashoffset = offset;
                text.textContent = `${percentage}%`;
            }
            
            // çµ±è¨ˆæƒ…å ±æ›´æ–°
            document.getElementById('overallStats').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 1.1em;">
                    <div><strong>åˆ¶è¦‡æ¸ˆã¿éƒ¨ä½:</strong> ${stats.eaten}/${stats.total}</div>
                    <div><strong>æ®‹ã‚Šéƒ¨ä½:</strong> ${stats.remaining}</div>
                    <div><strong>ç‰›:</strong> ${stats.animals.beef.eaten}/${stats.animals.beef.total} (${stats.animals.beef.completionRate}%)</div>
                    <div><strong>è±š:</strong> ${stats.animals.pork.eaten}/${stats.animals.pork.total} (${stats.animals.pork.completionRate}%)</div>
                    <div><strong>é³¥:</strong> ${stats.animals.chicken.eaten}/${stats.animals.chicken.total} (${stats.animals.chicken.completionRate}%)</div>
                    <div><strong>åˆ¶è¦‡å‹•ç‰©:</strong> ${Object.values(stats.animals).filter(a => a.completionRate === 100).length}/3</div>
                </div>
            `;
        }

        // ãƒ¬ãƒ™ãƒ«é€²æ—æ›´æ–°
        function updateLevelProgress() {
            const level = getUserLevel();
            const exp = getUserExperience();
            const expToNext = getExpToNextLevel();
            const levelProgress = getCurrentLevelProgress();
            
            document.getElementById('currentLevel').textContent = level;
            document.getElementById('currentExp').textContent = formatNumber(exp);
            document.getElementById('expToNext').textContent = formatNumber(expToNext);
            document.getElementById('levelProgressText').textContent = `${levelProgress}/100`;
            document.getElementById('levelProgressBar').style.width = `${levelProgress}%`;
        }

        // å‹•ç‰©åˆ¥è©³ç´°æ›´æ–°
        function updateAnimalDetails() {
            const container = document.getElementById('animalDetailsContainer');
            const animals = ['beef', 'pork', 'chicken'];
            
            container.innerHTML = '';
            
            animals.forEach(animalType => {
                const info = getAnimalInfo(animalType);
                const stats = getAnimalStats(animalType);
                const parts = getPartsByAnimal(animalType);
                const eatenParts = getEatenParts();
                
                const animalDiv = document.createElement('div');
                animalDiv.style.cssText = 'margin-bottom: 30px; padding: 20px; border: 2px solid #f0f0f0; border-radius: 10px;';
                
                // é£Ÿã¹ãŸéƒ¨ä½ã¨æœªé£Ÿéƒ¨ä½ã‚’åˆ†é¡
                const eatenAnimalParts = parts.filter(part => eatenParts.includes(part.id));
                const uneatennimalParts = parts.filter(part => !eatenParts.includes(part.id));
                
                animalDiv.innerHTML = `
                    <h3 style="margin-bottom: 15px; color: ${info.color};">
                        ${info.icon} ${info.name} 
                        <span style="font-size: 0.8em; color: #666;">(${stats.eaten}/${stats.total} - ${stats.completionRate}%)</span>
                    </h3>
                    
                    <div class="progress-bar" style="margin-bottom: 20px;">
                        <div class="progress-fill progress-${animalType}" style="width: ${stats.completionRate}%"></div>
                    </div>
                    
                    ${stats.completionRate === 100 ? 
                        '<div style="text-align: center; padding: 15px; background: #d4edda; border-radius: 8px; color: #155724; margin-bottom: 15px;">ğŸ‰ åˆ¶è¦‡å®Œäº†ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</div>' : ''
                    }
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4 style="color: #28a745; margin-bottom: 10px;">âœ… åˆ¶è¦‡æ¸ˆã¿ (${eatenAnimalParts.length})</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                                ${eatenAnimalParts.map(part => 
                                    `<span class="badge earned" title="${part.description}">${part.name}</span>`
                                ).join('')}
                            </div>
                        </div>
                        <div>
                            <h4 style="color: #6c757d; margin-bottom: 10px;">âŒ æœªåˆ¶è¦‡ (${uneatennimalParts.length})</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                                ${uneatennimalParts.map(part => 
                                    `<span class="badge not-earned" title="${part.description}">${part.name}</span>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(animalDiv);
            });
        }

        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        function updateStatistics() {
            const records = getRecords();
            const thisMonthRecords = getThisMonthRecords();
            const streakDays = getStreakDays();
            
            // å¹³å‡æº€è¶³åº¦
            const avgRating = records.length > 0 ? 
                records.reduce((sum, r) => sum + r.rating, 0) / records.length : 0;
            
            // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ¬ã‚¹ãƒˆãƒ©ãƒ³æ•°
            const uniqueRestaurants = new Set(
                records.filter(r => r.restaurant).map(r => r.restaurant)
            ).size;
            
            // åˆå›è¨˜éŒ²æ—¥
            const firstRecord = records.sort((a, b) => new Date(a.date) - new Date(b.date))[0];
            const firstRecordDate = firstRecord ? formatDate(firstRecord.date) : '-';
            
            document.getElementById('totalRecords').textContent = formatNumber(records.length);
            document.getElementById('thisMonthRecords').textContent = formatNumber(thisMonthRecords.length);
            document.getElementById('streakDays').textContent = formatNumber(streakDays);
            document.getElementById('averageRating').textContent = avgRating.toFixed(1);
            document.getElementById('uniqueRestaurants').textContent = formatNumber(uniqueRestaurants);
            document.getElementById('firstRecordDate').textContent = firstRecordDate;
        }

        // ãƒãƒƒã‚¸æ›´æ–°
        function updateBadges() {
            const container = document.getElementById('badgesContainer');
            const userBadges = getUserBadges();
            const allBadges = Object.keys(BADGES);
            
            container.innerHTML = '';
            
            if (allBadges.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">ãƒãƒƒã‚¸ã‚’ç²å¾—ã—ã‚ˆã†ï¼</div>';
                return;
            }
            
            // ç²å¾—æ¸ˆã¿ãƒãƒƒã‚¸
            if (userBadges.length > 0) {
                const earnedSection = document.createElement('div');
                earnedSection.innerHTML = `
                    <h4 style="color: #28a745; margin-bottom: 15px;">ğŸ† ç²å¾—æ¸ˆã¿ (${userBadges.length})</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 25px;">
                        ${userBadges.map(badge => 
                            `<span class="badge earned" title="${BADGES[badge]?.description || ''}">${badge}</span>`
                        ).join('')}
                    </div>
                `;
                container.appendChild(earnedSection);
            }
            
            // æœªç²å¾—ãƒãƒƒã‚¸
            const unearned = allBadges.filter(badge => !userBadges.includes(badge));
            if (unearned.length > 0) {
                const unearnedSection = document.createElement('div');
                unearnedSection.innerHTML = `
                    <h4 style="color: #6c757d; margin-bottom: 15px;">ğŸ”’ æœªç²å¾— (${unearned.length})</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        ${unearned.map(badge => 
                            `<span class="badge not-earned" title="${BADGES[badge]?.description || ''}">${badge}</span>`
                        ).join('')}
                    </div>
                `;
                container.appendChild(unearnedSection);
            }
        }

        // æœˆåˆ¥ã‚°ãƒ©ãƒ•æ›´æ–°
        function updateMonthlyChart() {
            const container = document.getElementById('monthlyChart');
            const records = getRecords();
            
            if (records.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            // éå»6ãƒ¶æœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ
            const monthlyData = {};
            const now = new Date();
            
            for (let i = 5; i >= 0; i--) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                monthlyData[key] = 0;
            }
            
            records.forEach(record => {
                const date = new Date(record.date);
                const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                if (monthlyData.hasOwnProperty(key)) {
                    monthlyData[key]++;
                }
            });
            
            const maxCount = Math.max(...Object.values(monthlyData), 1);
            
            container.innerHTML = `
                <div style="display: flex; align-items: end; gap: 10px; height: 150px; padding: 20px 0;">
                    ${Object.entries(monthlyData).map(([month, count]) => {
                        const height = (count / maxCount) * 100;
                        return `
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                <div style="background: linear-gradient(to top, #667eea, #764ba2); width: 100%; height: ${height}%; min-height: 5px; border-radius: 4px 4px 0 0; margin-bottom: 8px; position: relative;">
                                    <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 0.8em; font-weight: bold; color: #333;">${count}</div>
                                </div>
                                <div style="font-size: 0.8em; color: #666; writing-mode: vertical-rl; text-orientation: mixed;">
                                    ${month.split('-')[1]}æœˆ
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // å¸Œå°‘åº¦åˆ¥é€²æ—æ›´æ–°
        function updateRarityProgress() {
            const container = document.getElementById('rarityProgress');
            const eatenParts = getEatenParts();
            const allParts = getAllParts();
            
            const rarityStats = {
                common: { eaten: 0, total: 0 },
                uncommon: { eaten: 0, total: 0 },
                rare: { eaten: 0, total: 0 },
                legendary: { eaten: 0, total: 0 }
            };
            
            allParts.forEach(part => {
                rarityStats[part.rarity].total++;
                if (eatenParts.includes(part.id)) {
                    rarityStats[part.rarity].eaten++;
                }
            });
            
            container.innerHTML = Object.entries(rarityStats).map(([rarity, stats]) => {
                const rarityInfo = getRarityInfo(rarity);
                const percentage = stats.total > 0 ? Math.round((stats.eaten / stats.total) * 100) : 0;
                
                return `
                    <div class="progress-container" style="margin-bottom: 15px;">
                        <div class="progress-label">
                            <span style="color: ${rarityInfo.color};">
                                ${getRarityStars(rarity)} ${rarityInfo.label}
                            </span>
                            <span>${stats.eaten}/${stats.total} (${percentage}%)</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="background-color: ${rarityInfo.color}; width: ${percentage}%;"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportUserData() {
            exportData();
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        function handleImportFile(file) {
            if (file) {
                importData(file);
            }
        }
    </script>
</body>
</html>